<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bobby Black — Account</title>
  <link rel="icon" type="image/png" href="/images/BBE-Favicon.png" />
  <link rel="stylesheet" href="/styles.css" />
  <script defer src="/auth.js"></script>
  <script defer src="/header-auth.js"></script>

  <style>
    :root{color-scheme:dark}
    *{box-sizing:border-box}
    body { background:#000; color:#fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; }
    .site-header{position:sticky;top:0;z-index:50;background:rgba(0,0,0,.9);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid #111}
    .header-inner{max-width:1200px;margin:0 auto;padding:10px 16px;display:grid;grid-template-columns:auto 1fr auto;gap:16px;align-items:center}
    .brand-logo{height:42px;width:auto;display:block}
    .main-nav{display:flex;gap:18px;align-items:center;flex-wrap:wrap;justify-content:center}
    .main-nav a{font-size:12px;letter-spacing:.04em;text-transform:uppercase;text-decoration:none;color:#fff;opacity:.92;transition:opacity .18s ease,color .18s ease}
    .main-nav a:hover,.main-nav a:focus-visible{opacity:1;color:#d9d9d9}
    .header-search input{width:260px;max-width:100%;padding:9px 10px;border-radius:10px;border:1px solid #1f1f1f;background:#060606;color:#f3f3f3;font-size:12px;letter-spacing:.02em}
    .header-search input::placeholder{color:#8e8e8e}
    .wrap { max-width:900px; margin:24px auto 64px; padding:18px; }
    .card { background:#0b0b0b; border:1px solid #222; border-radius:14px; padding:18px; margin-top:14px; }
    h1 { font-size:26px; margin:0 0 6px; }
    h2 { font-size:16px; margin:0 0 10px; letter-spacing:0.04em; }
    p { color:#bdbdbd; margin:0; }
    .row { display:flex; gap:14px; flex-wrap:wrap; }
    .pill { padding:10px 12px; border-radius:12px; border:1px solid #2a2a2a; background:#070707; }
    .label { font-size:12px; color:#9a9a9a; }
    .value { font-size:20px; margin-top:4px; }
    button { padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#111; color:#fff; cursor:pointer; }
    button:hover { background:#151515; }
    a { color:#fff; text-decoration:underline; }
    .top { display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap; }
    .muted { color:#9a9a9a; }
    .list { margin-top:10px; }
    .order { padding:12px; border-radius:12px; border:1px solid #222; background:#060606; margin-top:10px; }
    @media(max-width:768px){.header-inner{grid-template-columns:1fr;gap:10px;justify-items:center}.main-nav{justify-content:center}.header-search{width:100%}.header-search input{width:100%}}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a class="brand" href="/">
        <img class="brand-logo" src="/images/Bobbyb.png" alt="Bobby Black" />
      </a>

      <nav class="main-nav" aria-label="Primary">
        <a href="/brands.html">Brands</a>
        <a href="/categories.html">Categories</a>
        <a href="/about.html">About</a>
        <a href="/member-signin.html" id="bbMemberLink">SIGN IN</a>
      </nav>

      <form class="header-search" role="search" action="#" method="GET">
        <input type="search" name="q" placeholder="WHAT CAN WE HELP YOU FIND?" aria-label="Search" />
      </form>
    </div>
  </header>

  <div class="wrap">
    <div class="top">
      <div>
        <h1>Account</h1>
        <p id="userLine" class="muted">Loading...</p>
      </div>
      <div>
        <button id="logoutBtn" type="button">Log out</button>
      </div>
    </div>

    <div class="card">
      <h2>Points Balance</h2>
      <div class="row">
        <div class="pill" style="min-width:220px;">
          <div class="label">Current Points</div>
          <div class="value" id="pointsValue">0</div>
        </div>
        <div class="pill" style="min-width:220px;">
          <div class="label">Estimated Value</div>
          <div class="value" id="pointsValueDollars">$0.00</div>
        </div>
      </div>
      <p style="margin-top:12px;">
        Earn <b>10 points per $1</b> spent (subtotal before tax). Default redemption: <b>100 points = $1 off</b>.
      </p>
    </div>

    <div class="card">
      <h2>Rewards Options</h2>
      <div class="list">
        <div class="order">
          <div><b>100 points</b> → $1 off</div>
          <div class="muted" style="margin-top:6px;">(Default conversion. We can add tier bonuses later.)</div>
        </div>
        <div class="order">
          <div><b>500 points</b> → $5 off</div>
        </div>
        <div class="order">
          <div><b>1,000 points</b> → $10 off</div>
        </div>
      </div>
      <p class="muted" style="margin-top:12px;">Redemption during checkout will be added after orders are saved in the database.</p>
    </div>

    <div class="card">
      <h2>Past Orders</h2>
      <div id="ordersList" class="list">
        <div class="order">
          <div><b>No orders yet</b></div>
          <div class="muted" style="margin-top:6px;">Your order history will appear here once orders are stored.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const userLine = document.getElementById("userLine");
    const pointsValue = document.getElementById("pointsValue");
    const pointsValueDollars = document.getElementById("pointsValueDollars");
    const logoutBtn = document.getElementById("logoutBtn");

    function formatMoney(n) {
      return "$" + (Math.round(n * 100) / 100).toFixed(2);
    }

    async function init() {
      const me = await window.bbGetMe();

      if (!me || !me.loggedIn) {
        window.location.href = "/member-signin.html";
        return;
      }

      const name = [me.user?.first_name, me.user?.last_name].filter(Boolean).join(" ").trim();
      userLine.textContent = name ? `${name} • ${me.user?.email}` : me.user?.email || "Signed in";

      const pts = Number(me.points_balance || 0);
      pointsValue.textContent = String(pts);

      const dollars = pts / 100;
      pointsValueDollars.textContent = formatMoney(dollars);
    }

    logoutBtn.addEventListener("click", async () => {
      await window.bbLogout();
      window.location.href = "/index.html";
    });

    window.addEventListener("DOMContentLoaded", () => {
      init().catch(() => {
        userLine.textContent = "Unable to load account.";
      });
    });
  </script>
</body>
</html>
